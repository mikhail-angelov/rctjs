{"version":3,"file":"rctjs.js","sources":["../src/patch.js","../src/index.js"],"sourcesContent":["export function patch(parent, oldNode, newNode) {\n  return patchElement(parent, parent.children[0], oldNode, newNode)\n}\n\nfunction setElementProp(element, name, value, oldValue) {\n  if (name === \"key\") {\n  } else if (name === \"style\") {\n    for (var i in Object.assign({}, oldValue, (value = value || {}))) {\n      element[name][i] = value[i] != null ? value[i] : \"\"\n    }\n  } else {\n    var empty = null == value || false === value\n\n    if (name in element) {\n      try {\n        element[name] = null == value ? \"\" : value\n      } catch (_) { }\n    } else if (!empty && typeof value !== \"function\") {\n      element.setAttribute(name, value === true ? \"\" : value)\n    }\n\n    if (empty) {\n      element.removeAttribute(name)\n    }\n  }\n}\n\nfunction createElement(node, isSVG) {\n  if (typeof node === \"string\") {\n    var element = document.createTextNode(node)\n  } else {\n    var element = (isSVG = isSVG || \"svg\" === node.type)\n      ? document.createElementNS(\"http://www.w3.org/2000/svg\", node.type)\n      : document.createElement(node.type)\n\n    for (var i = 0; i < node.children.length; i++) {\n      element.appendChild(createElement(node.children[i], isSVG))\n    }\n\n    for (var i in node.props) {\n      setElementProp(element, i, node.props[i])\n    }\n  }\n  return element\n}\n\nfunction updateElement(element, oldProps, props) {\n  for (var i in Object.assign({}, oldProps, props)) {\n    var oldValue = \"value\" === i || \"checked\" === i ? element[i] : oldProps?oldProps[i]:null\n\n    if (props[i] !== oldValue) {\n      setElementProp(element, i, props[i], oldValue)\n    }\n  }\n}\n\nfunction removeChildren(element, node, props) {\n  if ((props = node.props)) {\n    for (var i = 0; i < node.children.length; i++) {\n      removeChildren(element.childNodes[i], node.children[i])\n    }\n  }\n  return element\n}\n\nfunction removeElement(parent, element, node) {\n  parent.removeChild(removeChildren(element, node))\n}\n\nfunction patchElement(parent, element, oldNode, node, isSVG, nextSibling) {\n  if (oldNode == null){\n    element = parent.insertBefore(createElement(node, isSVG), element)\n  } else if (node.type != oldNode.type) {\n    const oldElement = element\n    element = parent.insertBefore(createElement(node, isSVG), oldElement)\n    removeElement(parent, oldElement, oldNode)\n  } else {\n    updateElement(element, oldNode.props, node.props)\n\n    isSVG = isSVG || node.type === \"svg\"\n    let childNodes = []\n      ; (element.childNodes || []).forEach(element => childNodes.push(element))\n    let oldNodeIdex = 0\n    if (node.children && node.children.length > 0) {\n      for (var i = 0; i < node.children.length; i++) {\n        if (oldNode.children && oldNodeIdex <= oldNode.children.length &&\n          (node.children[i].type && node.children[i].type === oldNode.children[oldNodeIdex].type ||\n            (!node.children[i].type && node.children[i] === oldNode.children[oldNodeIdex]))\n        ) {\n          patchElement(element, childNodes[oldNodeIdex], oldNode.children[oldNodeIdex], node.children[i], isSVG)\n          oldNodeIdex++\n        } else {\n          let newChild = element.insertBefore(\n            createElement(node.children[i], isSVG),\n            childNodes[oldNodeIdex]\n          )\n          patchElement(element, newChild, {}, node.children[i], isSVG)\n        }\n      }\n    }\n    for (var i = oldNodeIdex; i < childNodes.length; i++) {\n      removeElement(element, childNodes[i], oldNode.children?oldNode.children[i]||{}:{})\n    }\n  }\n  return element\n}","import { patch } from \"./patch\"\n\nexport function app(selector, view, initProps) {\n  const rootElement = document.querySelector(selector || 'body')\n  let node = view(initProps)\n  patch(rootElement, null, node)\n  return props => patch(rootElement, node, (node = view(props)))\n}\nexport function h(type, props, ...stack) {\n  const children = (stack || []).reduce(addChild, [])\n  props = props || {}\n  return typeof type === \"string\" ? { type, props, children } : type(props, children)\n}\n\nfunction addChild(acc, node) {\n  if (Array.isArray(node)) {\n    acc = node.reduce(addChild, acc)\n  } else if (null == node || true === node || false === node) {\n  } else {\n    acc.push(typeof node === \"number\" ? node + \"\" : node)\n  }\n  return acc\n}\n"],"names":[],"mappings":"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"}